<template name="recentConversations">
	<div class="panel panel-default">
        <div class="panel-body message-notifications">
            <div class="notifications-wrapper" id="style-1">
                {{#each messageNotifications}}
                    <div class="notification-item">
                        {{#if jobId}}
                            {{#with channelJob jobId}}
                                <div class="media">
                                    <div class="media-left">
                                        {{#if isInRole 'buyer, dispatcher'}}
                                            <a href="{{pathFor 'job'}}" class="budgetFont mark-job-message-read" data-job-id="{{_id}}">
                                                <img src="{{userImgUrl assignedProvider}}" class="media-object avatar-image img-circle" width='48px'>
                                            </a>
                                        {{/if}}
                                        {{#if isInRole 'provider'}}
                                            <a href="{{pathFor 'job'}}" class="budgetFont mark-job-message-read" data-job-id="{{_id}}">
                                                <img src="{{userImgUrl userId}}" class="media-object avatar-image img-circle" width='48px'>
                                            </a>
                                        {{/if}}
                                    </div>
                                    <div class="media-body">
                                        <a href="{{pathFor 'job'}}" class="budgetFont mark-job-msg-read" data-job-id="{{_id}}">
                                            {{#if isInRole 'buyer, dispatcher'}}
                                                #{{readableID}} {{title}}
                                                {{#with assignedProviderDetails _id}}
                                                    <span class="pull-right">
                                                        {{#if userOnline userId}}
                                                            &nbsp;<i class="fa fa-circle fa-online"></i>
                                                        {{else}}
                                                            &nbsp;<i class="fa fa-circle fa-offline"></i>
                                                        {{/if}}
                                                    </span>
                                                    <p>
                                                        <small>Asgn'd to: #{{readableID}} {{firstName}} {{lastName}}</small>
                                                    </p>
                                                {{/with}}
                                            {{/if}}
                                            {{#if isInRole 'provider'}}
                                                #{{readableID}} {{title}}
                                                {{#with jobPostedBuyer userId}}
                                                    <span class="pull-right">
                                                        {{#if userOnline userId}}
                                                            &nbsp;<i class="fa fa-circle fa-online"></i>
                                                        {{else}}
                                                            &nbsp;<i class="fa fa-circle fa-offline"></i>
                                                        {{/if}}
                                                    </span>
                                                    <p>
                                                        <small>Asgn'd by: #{{readableID}} {{firstName}} {{lastName}}</small>
                                                    </p>
                                                {{/with}}
                                            {{/if}}
                                            {{#if unreadJobMessages ../_id}}
                                                <br>
                                                <small><i class="mark-job-msg-read" data-job-id="{{_id}}">{{unreadJobMessages ../_id}} new messages</i></small>
                                            {{/if}}
                                        </a>
                                    </div>
                                </div>
                            {{/with}}
                        {{else}}
                            {{#with otherUser participants}}
                                {{#if $eq userRole 'provider'}}
                                    <div class="media">
                                        <div class="media-left">
                                            <a href="{{pathFor 'profile'}}" class="budgetFont mark-message-read" data-other-user="{{userId}}">
                                                <img src="{{userImgUrl userId}}" class="media-object avatar-image img-circle" width='48px'>
                                            </a>
                                        </div>
                                        <div class="media-body">
                                            <a href="{{pathFor 'profile'}}" class="budgetFont mark-message-read" data-other-user="{{userId}}">
                                                #{{readableID}}
                                                <br>
                                                {{firstName}} {{lastName}}
                                                {{#if userOnline userId}}
                                                    &nbsp;<i class="fa fa-circle fa-online"></i>
                                                {{else}}
                                                    &nbsp;<i class="fa fa-circle fa-offline"></i>
                                                {{/if}}
                                                {{#if unreadMessages ../_id}}
                                                    <br>
                                                    <small><i class="mark-message-read" data-other-user="{{userId}}">{{unreadMessages ../_id}} new messages</i></small>
                                                {{/if}}
                                            </a>
                                        </div>
                                    </div>
                                {{/if}}
                                {{#if $eq userRole 'buyer'}}
                                	<div class="media">
                                        <div class="media-left">
                                            <a href="{{pathFor 'buyer'}}" class="budgetFont mark-message-read" data-other-user="{{userId}}">
                                                <img src="{{userImgUrl userId}}" class="media-object avatar-image img-circle" width='48px'>
                                            </a>
                                        </div>
                                        <div class="media-body">
                                            <a href="{{pathFor 'buyer'}}" class="budgetFont mark-message-read" data-other-user="{{userId}}">
                                                #{{readableID}}<br>
                                                {{firstName}} {{lastName}}
                                                {{#if userOnline userId}}
                                                    &nbsp;<i class="fa fa-circle fa-online"></i>
                                                {{else}}
                                                    &nbsp;<i class="fa fa-circle fa-offline"></i>
                                                {{/if}}
                                                {{#if unreadMessages ../_id}}
                                                    <br>
                                                    <small><i class="mark-message-read" data-other-user="{{userId}}">{{unreadMessages ../_id}} new messages</i></small>
                                                {{/if}}
                                            </a>
                                        </div>
                                    </div>
                                {{/if}}
                                {{#if $eq userRole 'dispatcher'}}
                                    <div class="media">
                                        <div class="media-left">
                                            <a href="{{pathFor 'dispatcher'}}" class="budgetFont mark-message-read" data-other-user="{{userId}}">
                                                <img src="{{userImgUrl userId}}" class="media-object avatar-image img-circle" width='48px'>
                                            </a>
                                        </div>
                                        <div class="media-body">
                                            <a href="{{pathFor 'dispatcher'}}" class="budgetFont mark-message-read" data-other-user="{{userId}}">
                                                #{{readableID}}<br>
                                                {{firstName}} {{lastName}}
                                                {{#if userOnline userId}}
                                                    &nbsp;<i class="fa fa-circle fa-online"></i>
                                                {{else}}
                                                    &nbsp;<i class="fa fa-circle fa-offline"></i>
                                                {{/if}}
                                                {{#if unreadMessages ../_id}}
                                                    <br>
                                                    <small><i class="mark-message-read" data-other-user="{{userId}}">{{unreadMessages ../_id}} new messages</i></small>
                                                {{/if}}
                                            </a>
                                        </div>
                                    </div>
                                {{/if}}
                                {{#if $eq userRole 'accountant'}}
                                    <div class="media">
                                        <div class="media-left">
                                            <a href="{{pathFor 'profile'}}" class="budgetFont mark-message-read" data-other-user="{{userId}}">
                                                <img src="{{userImgUrl userId}}" class="media-object avatar-image img-circle" width='48px'>
                                            </a>
                                        </div>
                                        <div class="media-body">
                                            <a href="{{pathFor 'accountant'}}" class="budgetFont">
                                                #{{readableID}}<br>
                                                {{firstName}} {{lastName}}
                                                {{#if userOnline userId}}
                                                    &nbsp;<i class="fa fa-circle fa-online"></i>
                                                {{else}}
                                                    &nbsp;<i class="fa fa-circle fa-offline"></i>
                                                {{/if}}
                                                {{#if unreadMessages ../_id}}
                                                    <br>
                                                    <small><i class="mark-message-read" data-other-user="{{userId}}">{{unreadMessages ../_id}} new messages</i></small>
                                                {{/if}}
                                            </a>
                                        </div>
                                    </div>
                                {{/if}}
                            {{/with}}
                        {{/if}}
                    </div>
                {{/each}}
            </div>
        </div>
    </div>
</template>