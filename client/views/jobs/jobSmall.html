<template name="jobSmall">
    <div class="jobSmall panel panel-default {{#if $eq applicationStatus 'open'}}openJob{{/if}} {{#if $eq applicationStatus 'frozen'}}frozenJob{{/if}} {{#if $eq applicationStatus 'assigned'}}assignedJob{{/if}} {{#if $eq applicationStatus 'completed'}}completedJob{{/if}} {{#if $eq applicationStatus 'pending_payment'}}paymentPendingJob{{/if}} {{#if $eq applicationStatus 'paid'}}paidJob{{/if}}">
        <div class="panel-body">
            <div class="row">
                <div class="col-sm-8">
                    <span class="label label-xs label-default">{{readableID}}</span>
                    {{>jobLabels}}
                    <h4>
                        <a href="{{#if currentUser}}{{pathFor 'job'}}{{else}}/sign-in{{/if}}">{{title}}</a>
                        <br>
                        <small>
                            {{#if $eq servicelocation 'Remote Job'}}
                                <i class="fa fa-map-marker"></i>&nbsp;{{servicelocation}}
                            {{else}}
                                <i class="fa fa-map-marker"></i>&nbsp;{{location}}
                            {{/if}}
                        </small>
                    </h4>
                </div>
                <div class="col-sm-4">
                    <small>
                        Budget{{#if freelancer_nets}}&nbsp;-&nbsp;{{freelancer_nets}}&nbsp;USD{{/if}}
                    </small>    
                    <br>
                    <small>
                        Posted {{#with buyerData}}by <a href="{{pathFor 'buyer'}}">{{name}}</a>{{/with}}&nbsp;-&nbsp;{{postedTime}}                        
                    </small>
                    <br>
                    <small>
                        <span class="label label-sm {{appStatusLabel}}">Status: {{applicationStatus}}</span>
                        {{#if assignedProvider}}
                            &nbsp;{{#if $eq applicationStatus 'assigned'}}to{{else}}{{#if $eq applicationStatus 'completed'}}by{{/if}}{{/if}}&nbsp;{{#with assignedProfile}} <a href="{{pathFor 'profile'}}">{{this.name}}</a>{{/with}}
                        {{/if}}
                        &nbsp;|&nbsp;{{#if selectedProvider}}Routed to {{#with routedProvider}} <a href="{{pathFor 'profile'}}">{{this.name}}</a>{{/with}}{{else}}Applications: {{applicationsCount}}{{/if}}
                    </small>
                </div>
                {{#if acceptedProvider}}
                    {{#if $eq applicationStatus 'frozen'}}
                        <div class="col-sm-12">
                            <hr>
                            {{#if routed}}
                                <p>This job has been routed to you. Please confirm to begin the job or decline.</p>
                            {{else}}
                                <p>Your application has been accepted by the buyer. Please confirm to begin the job.</p>
                            {{/if}}
                            <button class="margin-top-5 btn btn-primary btn-sm confirmAssignment">Confirm</button>
                            <button class="margin-top-5 btn btn-warning btn-sm declineAssignment">Decline</button>
                        </div>
                    {{/if}}
                    {{#if $eq applicationStatus 'assigned'}}
                        {{#if $eq assignmentStatus 'rejected'}}
                            <div class="col-sm-12">
                                <hr>
                                <p>You have confirmed to do the job. Finish all the tasks and fill up your timesheets to submit the job for buyer approval.</p>
                                <button class="margin-top-5 btn btn-primary btn-sm submitAssignment">Submit Job for Approval.</button>
                            </div>
                        {{/if}}
                        {{#if $eq assignmentStatus 'submitted'}}
                            <div class="col-sm-12">
                                <hr>
                                <small>You've submitted this job for buyer's approval. You'll be notified when the buyer approves.</small>
                            </div>
                        {{/if}}
                    {{/if}}
                    {{#if $eq applicationStatus 'completed'}}
                        {{#if $eq assignmentStatus 'approved'}}
                            <div class="col-sm-12">
                                <hr>
                                <p>The buyer has approved your job. You can now raise an invoice and request for payment.</p>
                                <button class=" margin-top-5 btn btn-sm btn-primary requestPayment">Raise Invoice &amp; Request Payment</button>
                            </div>
                        {{/if}}
                    {{/if}}
                    {{#if $eq applicationStatus 'paid'}}
                        <div class="col-sm-12">
                            {{#if reviewedBuyer}}
                                <hr>
                                You've reviewed the buyer for this job.
                            {{else}}
                                <hr>
                                <form id="reviewBuyer">
                                    <div class="form-group">                                    
                                        <label for="writeReview">Write a review</label>
                                        <textarea name="reviewMessage" id="writeReview" rows="3" class="form-control"></textarea><br>
                                        <label>Rate buyer</label><br><span class="rateit"></span>
                                    </div>
                                    <button class="margin-top-5 btn btn-primary" type="submit">Submit</button>
                                </form>
                            {{/if}}
                        </div>
                    {{/if}}
                {{else}}
                    {{#if jobPostedBuyer}}
                        {{#if $eq assignmentStatus 'submitted'}}
                            <div class="col-sm-12">
                                <hr>
                                <p>The provider has submitted the job for your perusal. Please check the job done and take action.</p>
                                <button class="margin-top-5 btn btn-primary btn-sm approveAssignment">Approve Assignment</button>
                                <button class="margin-top-5 btn btn-primary btn-sm rejectAssignment">Reject Assignment</button>
                            </div>
                        {{else}}
                            {{#if $eq assignmentStatus 'pending_payment'}}
                                <div class="col-sm-12">
                                    <hr>
                                    <button class="btn btn-sm btn-primary margin-top-5 approvePayment">Approve Payment</button>
                                </div>
                            {{/if}}
                        {{/if}}
                        {{#if $eq applicationStatus 'paid'}}
                            <div class="col-sm-12">
                                {{#if reviewedProvider}}
                                    <hr>
                                    You've reviewed the provider for this job.
                                {{else}}
                                    <hr>
                                    <form id="reviewProvider">
                                        <div class="form-group">                                 
                                            <label for="writeReview">Write a review</label>
                                            <textarea name="reviewMessage" id="writeReview" rows="3" class="form-control"></textarea><br>
                                            <label>Rate provider</label><br><span class="rateit"></span>
                                        </div>
                                        <button class="margin-top-5 btn btn-primary" type="submit">Submit</button>
                                    </form>
                                {{/if}}
                            </div>
                        {{/if}}
                    {{/if}}
                {{/if}}
            </div>
        </div>
    </div>
</template>
